<UserControl x:Class="PraxisWpf.Features.TaskViewer.TaskView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:PraxisWpf.Features.TaskViewer"
             xmlns:models="clr-namespace:PraxisWpf.Models"
             xmlns:controls="clr-namespace:PraxisWpf.Controls">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Help Overlay (hidden by default) -->
        <controls:HelpOverlay x:Name="HelpOverlay" 
                              Grid.RowSpan="2"
                              Visibility="Collapsed" 
                              CloseRequested="HelpOverlay_CloseRequested"
                              Panel.ZIndex="1000"/>

        <!-- Header row with cyber styling -->
        <Border Grid.Row="0" BorderBrush="{DynamicResource CyberBorderBrush}" 
                BorderThickness="0,0,0,1" Background="{DynamicResource CyberControlBrush}"
                Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="50"/>
                    <ColumnDefinition Width="50"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="║ ID1" 
                          Foreground="{DynamicResource CyberTextBrush}"
                          FontWeight="Bold" FontSize="14"/>
                <TextBlock Grid.Column="1" Text="║ ID2" 
                          Foreground="{DynamicResource CyberTextBrush}"
                          FontWeight="Bold" FontSize="14"/>
                <TextBlock Grid.Column="2" Text="║ ASSIGNED" 
                          Foreground="{DynamicResource CyberTextBrush}"
                          FontWeight="Bold" FontSize="14"/>
                <TextBlock Grid.Column="3" Text="║ DUE DATE" 
                          Foreground="{DynamicResource CyberTextBrush}"
                          FontWeight="Bold" FontSize="14"/>
                <TextBlock Grid.Column="4" Text="║ BRING FWD" 
                          Foreground="{DynamicResource CyberTextBrush}"
                          FontWeight="Bold" FontSize="14"/>
                <TextBlock Grid.Column="5" Text="║P" 
                          Foreground="{DynamicResource CyberTextBrush}"
                          FontWeight="Bold" FontSize="14"/>
                <TextBlock Grid.Column="6" Text="║ TASK NAME/DETAIL" 
                          Foreground="{DynamicResource CyberTextBrush}"
                          FontWeight="Bold" FontSize="14"/>
            </Grid>
        </Border>

        <TreeView Grid.Row="1" Name="TaskTreeView" ItemsSource="{Binding Items}" 
                  SelectedItemChanged="TaskTreeView_SelectedItemChanged"
                  KeyDown="TaskTreeView_KeyDown"
                  Focusable="True"
                  TabIndex="0">
            <TreeView.Resources>
                <HierarchicalDataTemplate DataType="{x:Type models:TaskItem}" 
                                        ItemsSource="{Binding Children}">
                    <Border BorderBrush="{DynamicResource CyberBorderBrush}" 
                            BorderThickness="1" 
                            Background="{DynamicResource CyberBackgroundBrush}"
                            Padding="8,4" 
                            Margin="2">
                        <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="50"/>
                            <ColumnDefinition Width="50"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- ID1 -->
                        <TextBlock Grid.Column="0" Text="{Binding Id1}" VerticalAlignment="Center"
                                   Visibility="{Binding IsInEditMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                   Foreground="{DynamicResource CyberTextBrush}" FontWeight="Bold" FontSize="14"/>
                        <TextBox Grid.Column="0" Text="{Binding Id1, UpdateSourceTrigger=PropertyChanged}" 
                                 Visibility="{Binding IsInEditMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                 VerticalAlignment="Center" FontSize="14" TabIndex="1"
                                 KeyDown="EditTextBox_KeyDown"/>

                        <!-- ID2 -->
                        <TextBlock Grid.Column="1" Text="{Binding Id2}" VerticalAlignment="Center"
                                   Visibility="{Binding IsInEditMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                   Foreground="{DynamicResource CyberTextBrush}" FontWeight="Bold" FontSize="14"/>
                        <TextBox Grid.Column="1" Text="{Binding Id2, UpdateSourceTrigger=PropertyChanged}" 
                                 Visibility="{Binding IsInEditMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                 VerticalAlignment="Center" FontSize="14" TabIndex="2"
                                 KeyDown="EditTextBox_KeyDown"/>

                        <!-- Assigned Date -->
                        <TextBlock Grid.Column="2" VerticalAlignment="Center"
                                   Visibility="{Binding IsInEditMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                   Text="{Binding AssignedDate, Converter={StaticResource DateDisplayConverter}}"
                                   Foreground="{DynamicResource CyberTextBrush}" FontWeight="Bold" FontSize="14"/>
                        <DatePicker Grid.Column="2" SelectedDate="{Binding AssignedDate, UpdateSourceTrigger=PropertyChanged}" 
                                    Visibility="{Binding IsInEditMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                    VerticalAlignment="Center" FontSize="14" TabIndex="3"
                                    KeyDown="EditTextBox_KeyDown"/>

                        <!-- Due Date -->
                        <TextBlock Grid.Column="3" VerticalAlignment="Center"
                                   Visibility="{Binding IsInEditMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                   Text="{Binding DueDate, Converter={StaticResource DateDisplayConverter}}"
                                   Foreground="{DynamicResource CyberAccentBrush}" FontWeight="Bold">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Foreground" Value="{DynamicResource CyberTextBrush}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="FontSize" Value="14"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Priority}" Value="High">
                                            <Setter Property="Foreground" Value="{DynamicResource CyberErrorBrush}"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <DatePicker Grid.Column="3" SelectedDate="{Binding DueDate, UpdateSourceTrigger=PropertyChanged}" 
                                    Visibility="{Binding IsInEditMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                    VerticalAlignment="Center" FontSize="14" TabIndex="4"
                                    KeyDown="EditTextBox_KeyDown"/>

                        <!-- Bring Forward Date -->
                        <TextBlock Grid.Column="4" VerticalAlignment="Center"
                                   Visibility="{Binding IsInEditMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                   Text="{Binding BringForwardDate, Converter={StaticResource DateDisplayConverter}}"
                                   Foreground="{DynamicResource CyberTextBrush}" FontWeight="Bold" FontSize="14"/>
                        <DatePicker Grid.Column="4" SelectedDate="{Binding BringForwardDate, UpdateSourceTrigger=PropertyChanged}" 
                                    Visibility="{Binding IsInEditMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                    VerticalAlignment="Center" FontSize="14" TabIndex="5"
                                    KeyDown="EditTextBox_KeyDown"/>

                        <!-- Priority -->
                        <TextBlock Grid.Column="5" VerticalAlignment="Center"
                                   Visibility="{Binding IsInEditMode, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Priority}" Value="High">
                                            <Setter Property="Foreground" Value="{DynamicResource CyberErrorBrush}"/>
                                            <Setter Property="Text" Value="H"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Priority}" Value="Medium">
                                            <Setter Property="Foreground" Value="{DynamicResource CyberWarningBrush}"/>
                                            <Setter Property="Text" Value="M"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Priority}" Value="Low">
                                            <Setter Property="Foreground" Value="{DynamicResource CyberInfoBrush}"/>
                                            <Setter Property="Text" Value="L"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <ComboBox Grid.Column="5" SelectedItem="{Binding Priority, UpdateSourceTrigger=PropertyChanged}" 
                                  Visibility="{Binding IsInEditMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                  VerticalAlignment="Center" FontSize="14" Width="25" TabIndex="6"
                                  KeyDown="EditTextBox_KeyDown">
                            <ComboBox.Items>
                                <models:PriorityType>High</models:PriorityType>
                                <models:PriorityType>Medium</models:PriorityType>
                                <models:PriorityType>Low</models:PriorityType>
                            </ComboBox.Items>
                        </ComboBox>

                        <!-- Name column -->
                        <TextBlock Grid.Column="6" Text="{Binding Name}" 
                                   Visibility="{Binding IsInEditMode, Converter={StaticResource InverseBoolToVisibilityConverter}}" 
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource CyberTextBrush}" FontWeight="Bold" FontSize="14"/>
                        <TextBox Grid.Column="6" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                 Visibility="{Binding IsInEditMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                 BorderThickness="1" VerticalAlignment="Center"
                                 Name="EditTextBox" TabIndex="7"
                                 KeyDown="EditTextBox_KeyDown"
                                 Loaded="EditTextBox_Loaded"/>
                        </Grid>
                    </Border>
                </HierarchicalDataTemplate>
            </TreeView.Resources>
        </TreeView>
    </Grid>
</UserControl>