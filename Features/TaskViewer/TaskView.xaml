<UserControl x:Class="PraxisWpf.Features.TaskViewer.TaskView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:PraxisWpf.Features.TaskViewer"
             xmlns:models="clr-namespace:PraxisWpf.Models">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header row with cyber styling -->
        <Border Grid.Row="0" BorderBrush="{DynamicResource CyberBorderBrush}" 
                BorderThickness="0,0,0,1" Background="{DynamicResource CyberControlBrush}"
                Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="║ ID1" FontWeight="Bold" 
                          Foreground="{DynamicResource CyberAccentBrush}"/>
                <TextBlock Grid.Column="1" Text="║ ID2" FontWeight="Bold" 
                          Foreground="{DynamicResource CyberAccentBrush}"/>
                <TextBlock Grid.Column="2" Text="║ ASSIGNED" FontWeight="Bold" 
                          Foreground="{DynamicResource CyberAccentBrush}"/>
                <TextBlock Grid.Column="3" Text="║ DUE DATE" FontWeight="Bold" 
                          Foreground="{DynamicResource CyberAccentBrush}"/>
                <TextBlock Grid.Column="4" Text="║P" FontWeight="Bold" 
                          Foreground="{DynamicResource CyberAccentBrush}"/>
                <TextBlock Grid.Column="5" Text="║S" FontWeight="Bold" 
                          Foreground="{DynamicResource CyberAccentBrush}"/>
                <TextBlock Grid.Column="6" Text="║ TASK NAME/DETAIL" FontWeight="Bold" 
                          Foreground="{DynamicResource CyberAccentBrush}"/>
            </Grid>
        </Border>

        <TreeView Grid.Row="1" Name="TaskTreeView" ItemsSource="{Binding Items}" 
                  SelectedItemChanged="TaskTreeView_SelectedItemChanged"
                  KeyDown="TaskTreeView_KeyDown"
                  Focusable="True"
                  TabIndex="0">
            <TreeView.Resources>
                <HierarchicalDataTemplate DataType="{x:Type models:TaskItem}" 
                                        ItemsSource="{Binding Children}">
                    <Border BorderBrush="{DynamicResource CyberBorderBrush}" 
                            BorderThickness="0,0,0,1" Opacity="0.3"
                            Padding="4,2">
                        <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- ID1 -->
                        <TextBlock Grid.Column="0" Text="{Binding Id1}" VerticalAlignment="Center"
                                   Foreground="{DynamicResource CyberAccentBrush}"/>

                        <!-- ID2 -->
                        <TextBlock Grid.Column="1" Text="{Binding Id2}" VerticalAlignment="Center"
                                   Foreground="{DynamicResource CyberAccentBrush}"/>

                        <!-- Assigned Date -->
                        <TextBlock Grid.Column="2" VerticalAlignment="Center"
                                   Text="{Binding AssignedDate, Converter={StaticResource DateDisplayConverter}}"
                                   Foreground="{DynamicResource CyberDimCyanBrush}"/>

                        <!-- Due Date -->
                        <TextBlock Grid.Column="3" VerticalAlignment="Center"
                                   Text="{Binding DueDate, Converter={StaticResource DateDisplayConverter}}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Foreground" Value="{DynamicResource CyberDimCyanBrush}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Priority}" Value="High">
                                            <Setter Property="Foreground" Value="{DynamicResource CyberErrorBrush}"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Priority with single character -->
                        <TextBlock Grid.Column="4" VerticalAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Priority}" Value="High">
                                            <Setter Property="Foreground" Value="{DynamicResource CyberErrorBrush}"/>
                                            <Setter Property="Text" Value="H"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Priority}" Value="Medium">
                                            <Setter Property="Foreground" Value="{DynamicResource CyberWarningBrush}"/>
                                            <Setter Property="Text" Value="M"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Priority}" Value="Low">
                                            <Setter Property="Foreground" Value="{DynamicResource CyberInfoBrush}"/>
                                            <Setter Property="Text" Value="L"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Sub-tasks indicator (placeholder for now) -->
                        <TextBlock Grid.Column="5" Text="-" VerticalAlignment="Center"
                                   Foreground="{DynamicResource CyberDimCyanBrush}"/>

                        <!-- Name column - switches between TextBlock and TextBox -->
                        <TextBlock Grid.Column="6" Text="{Binding Name}" 
                                   Visibility="{Binding IsInEditMode, Converter={StaticResource InverseBoolToVisibilityConverter}}" 
                                   VerticalAlignment="Center"/>
                        <TextBox Grid.Column="6" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                 Visibility="{Binding IsInEditMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                 BorderThickness="1" VerticalAlignment="Center"
                                 Name="EditTextBox"
                                 KeyDown="EditTextBox_KeyDown"
                                 Loaded="EditTextBox_Loaded"/>
                        </Grid>
                    </Border>
                </HierarchicalDataTemplate>
            </TreeView.Resources>
        </TreeView>
    </Grid>
</UserControl>